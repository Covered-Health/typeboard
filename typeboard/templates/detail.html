{% extends "base.html" %}
{% block content %}
<div class="fade-in">
    <wa-breadcrumb>
        {% if resource.list_fn %}
        <wa-breadcrumb-item href="{{ base_path }}/{{ resource.id }}/">{{ resource.label }}</wa-breadcrumb-item>
        {% endif %}
        <wa-breadcrumb-item>{{ display_name or id }}</wa-breadcrumb-item>
    </wa-breadcrumb>

    <div class="page-header">
        <h1>{{ display_name or (resource.label ~ " #" ~ id) }}</h1>
        <div class="actions">
            {% if resource.update_fn %}
            <wa-button variant="brand" href="{{ base_path }}/{{ resource.id }}/{{ id }}/edit">
                <wa-icon slot="start" name="pen"></wa-icon>
                Edit
            </wa-button>
            {% endif %}
            {% if resource.list_fn %}
            <wa-button appearance="outlined" href="{{ base_path }}/{{ resource.id }}/">
                <wa-icon slot="start" name="arrow-left"></wa-icon>
                Back to list
            </wa-button>
            {% endif %}
        </div>
    </div>

    {% if item %}
    <wa-card>
        <dl class="detail-grid">
            {% for col in columns %}
            {% if not col.hidden %}
            <dt>{{ col.label }}</dt>
            <dd>
                {% set val = item_value(item, col.name) %}
                {% set rel_target = relationship_targets.get(col.name) if relationship_targets is defined else None %}
                {% if val is iterable and val is not string and val is not mapping %}
                <div style="display:flex;gap:4px;flex-wrap:wrap;">
                    {% for v in val %}
                    {% if rel_target and v is iterable and v is not string %}
                    <a href="{{ base_path }}/{{ rel_target }}/{{ v[0] }}" style="text-decoration:none;">
                        <wa-tag size="small" variant="neutral" pill style="padding:0 6px;cursor:pointer;">{{ v[1] }}</wa-tag>
                    </a>
                    {% else %}
                    <wa-tag size="small" variant="neutral" pill style="padding:0 6px;">{{ v }}</wa-tag>
                    {% endif %}
                    {% endfor %}
                    {% if not val %}<span style="color:var(--wa-color-neutral-50);">None</span>{% endif %}
                </div>
                {% else %}
                {% if rel_target and val is iterable and val is not string %}
                <a href="{{ base_path }}/{{ rel_target }}/{{ val[0] }}">{{ val[1] }}</a>
                {% else %}
                {{ val }}
                {% endif %}
                {% endif %}
            </dd>
            {% endif %}
            {% endfor %}
        </dl>
    </wa-card>
    {% else %}
    <div class="empty-state">Record not found.</div>
    {% endif %}
</div>
{% endblock %}
