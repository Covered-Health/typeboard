{% extends "base.html" %}
{% block content %}
<div class="fade-in">
    <div class="page-header">
        <h1>{{ resource.name | replace("_", " ") | title }}</h1>
        <div class="actions">
            {% if resource.create_fn %}
            <wa-button variant="brand" href="{{ base_path }}/{{ resource.name }}/new">
                <wa-icon slot="start" name="plus"></wa-icon>
                New
            </wa-button>
            {% endif %}
        </div>
    </div>

    {% if resource.filter_fields %}
    <form class="filters" hx-get="{{ base_path }}/{{ resource.name }}/rows" hx-target="#table-body" hx-trigger="submit" hx-swap="innerHTML">
        {% for field in resource.filter_fields %}
        <div>
            {% if field.filter == "search" %}
            <wa-input type="search" name="{{ field.name }}" placeholder="Search {{ field.label | lower }}..." size="small" with-clear></wa-input>
            {% elif field.filter == "select" %}
            <wa-select name="{{ field.name }}" placeholder="All {{ field.label | lower }}" size="small">
                <wa-option value="">All</wa-option>
                {% if field.enum_choices %}
                {% for value, label in field.enum_choices %}
                <wa-option value="{{ value }}">{{ label }}</wa-option>
                {% endfor %}
                {% endif %}
            </wa-select>
            {% else %}
            <wa-input type="text" name="{{ field.name }}" placeholder="{{ field.label }}" size="small"></wa-input>
            {% endif %}
        </div>
        {% endfor %}
        <wa-button type="submit" appearance="outlined" size="small">
            <wa-icon slot="start" name="magnifying-glass"></wa-icon>
            Filter
        </wa-button>
    </form>
    {% endif %}

    <table>
        <thead>
            <tr>
                {% for col in resource.columns %}
                {% if col.column and not col.hidden %}
                <th>
                    <a hx-get="{{ base_path }}/{{ resource.name }}/rows?sort={{ col.name }}" hx-target="#table-body" hx-swap="innerHTML">
                        {{ col.label }}
                    </a>
                </th>
                {% endif %}
                {% endfor %}
                {% if resource.delete_fn %}
                <th style="text-align:right;">Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody id="table-body"
               hx-get="{{ base_path }}/{{ resource.name }}/rows"
               hx-trigger="load"
               hx-swap="innerHTML">
            <tr><td colspan="100" class="empty-state">Loading...</td></tr>
        </tbody>
    </table>
</div>
{% endblock %}
